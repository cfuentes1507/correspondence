<odoo>
    <data>
        <!-- Acción para la Bandeja de Entrada de USUARIOS (vista de árbol) -->
        <record id="action_correspondence_document_tree" model="ir.actions.act_window">
            <field name="name">Bandeja de Entrada</field>
            <field name="res_model">correspondence_document</field>
            <field name="view_mode">tree,form,kanban</field>
            <field name="domain">[('recipient_department_ids.user_ids', '=', uid), ('state', 'in', ['sent', 'assigned', 'replied'])]</field>
            <field name="context">{'search_default_my_department': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Aún no has recibido correspondencia.
                </p>
            </field>
        </record>

        <!-- Acción para la Bandeja de Entrada de ADMINISTRADORES (sin dominio restrictivo) -->
        <record id="action_correspondence_document_tree_admin" model="ir.actions.act_window">
            <field name="name">Bandeja de Entrada (Admin)</field>
            <field name="res_model">correspondence_document</field>
            <field name="view_mode">tree,form,kanban</field>
            <field name="domain">[('state', 'in', ['sent', 'assigned', 'replied'])]</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Aún no hay correspondencia en el sistema.
                </p>
            </field>
        </record>

        <!-- 
            Acción para la nueva vista de "Gestión Externa".
            Muestra los documentos ENTRANTES dirigidos al departamento del usuario.
            Desde aquí se podrán generar las respuestas SALIENTES.
        -->
        <record id="action_correspondence_external_management" model="ir.actions.act_window">
            <field name="name">Gestión de Correspondencia Externa</field>
            <field name="res_model">correspondence_document</field>
            <field name="view_mode">tree,form,kanban</field>
            <field name="domain">[('correspondence_flow', 'in', ['incoming', 'outgoing'])]</field>
            <field name="context">{'default_correspondence_flow': 'incoming'}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Aquí aparecerá la correspondencia externa asignada a tu departamento.
                </p><p>Selecciona un documento y haz clic en "Responder" para generar un documento de salida.</p>
            </field>
        </record>

        <!-- Acción base para el Archivo (usada por la acción de servidor) -->
        <record id="action_correspondence_document_archive_base" model="ir.actions.act_window">
            <field name="name">Archivo de Correspondencia</field>
            <field name="res_model">correspondence_document</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="domain">[]</field> <!-- El dominio se establecerá dinámicamente -->
            <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'kanban', 'view_id': ref('correspondence.correspondence_document_view_kanban_archive')}),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('correspondence.correspondence_document_view_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('correspondence.correspondence_document_view_form')})]"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Aquí se mostrarán todos los documentos de correspondencia.
                </p><p>
                    Usa el panel de la izquierda para filtrar por estado, tipo o departamento.
                </p>
            </field>
        </record>

        <!-- Acción para Tipos de Correspondencia -->
        <record id="action_correspondence_type" model="ir.actions.act_window">
            <field name="name">Tipos de Correspondencia</field>
            <field name="res_model">correspondence_type</field>
            <field name="view_mode">tree,form</field>
        </record>

        <!-- Acción para Departamentos -->
        <record id="action_correspondence_department" model="ir.actions.act_window">
            <field name="name">Departamentos</field>
            <field name="res_model">correspondence_department</field>
            <field name="view_mode">tree,form</field>
        </record>

        <!-- Acción de servidor para la Bandeja de Salida -->
        <record id="action_server_open_outbox" model="ir.actions.server">
            <field name="name">Bandeja de Salida</field>
            <field name="model_id" ref="model_correspondence_document"/>
            <field name="state">code</field>
            <field name="code">action = model.action_open_outbox()</field>
        </record>

        <!-- Acción de servidor para el Archivo -->
        <record id="action_server_open_archive" model="ir.actions.server">
            <field name="name">Archivo de Correspondencia</field>
            <field name="model_id" ref="model_correspondence_document"/>
            <field name="state">code</field>
            <field name="code">action = model.action_open_archive()</field>
        </record>

        <!-- Menú principal de Correspondencia -->
        <menuitem id="menu_correspondence_root" name="Correspondencia" sequence="10" web_icon="correspondence,static/description/icon.png"/>

        <!-- Menú para Bandeja de Entrada (solo para usuarios no-admin) -->
        <menuitem id="menu_correspondence_inbox_user" name="Bandeja de Entrada" parent="menu_correspondence_root" sequence="10" action="action_correspondence_document_tree" groups="correspondence.correspondence_group_user,correspondence.correspondence_group_director"/>
        <!-- Menú para Bandeja de Entrada (solo para administradores) -->
        <menuitem id="menu_correspondence_inbox_admin" name="Bandeja de Entrada (Admin)" parent="menu_correspondence_root" sequence="15" action="action_correspondence_document_tree_admin" groups="correspondence.correspondence_group_admin"/>

        <menuitem name="Bandeja de Salida" id="menu_correspondence_outbox" parent="menu_correspondence_root" sequence="20" action="action_server_open_outbox"/>

        <!-- Nuevo menú para la gestión de correspondencia externa -->
        <menuitem id="menu_correspondence_external_management" name="Gestión Externa" parent="menu_correspondence_root" sequence="22" action="action_correspondence_external_management" groups="correspondence.correspondence_group_external_management"/>

        <!-- Menú para el Archivo -->
        <menuitem id="menu_correspondence_archive" name="Archivo" parent="menu_correspondence_root" sequence="30" action="action_server_open_archive"/>


        <!-- Menú de Configuración -->
        <menuitem id="menu_correspondence_config" name="Configuración" parent="menu_correspondence_root" sequence="100" groups="correspondence.correspondence_group_admin"/>
        
        <!-- Submenús de Configuración -->
        <menuitem id="menu_correspondence_type" name="Tipos de Correspondencia" parent="menu_correspondence_config" sequence="10" action="action_correspondence_type"/>
        <menuitem id="menu_correspondence_department" name="Departamentos" parent="menu_correspondence_config" sequence="20" action="action_correspondence_department"/>
    </data>
</odoo>