<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="public_correspondence_template" name="Public Correspondence Document">
        <t t-call="website.layout">
            <div id="wrap" class="container">
                <div class="oe_structure">
                    <div class="page">
                        <h1 class="mt-4">Verificación de Documento</h1>
                        <hr/>
                        <div class="row">
                            <div class="col-md-8">
                                <p><strong>Asunto:</strong> <span t-field="doc.name"/></p>
                                <p><strong>Correlativo:</strong> <span t-field="doc.correlative"/></p>
                                <p><strong>Fecha:</strong> <span t-field="doc.date" t-options='{"widget": "date"}'/></p>
                                <p><strong>Tipo:</strong> <span t-field="doc.correspondence_type.name"/></p>

                                <!-- Lógica para mostrar remitente y destinatario según el flujo -->
                                <div t-if="doc.correspondence_flow == 'internal'">
                                    <p><strong>Departamento Remitente:</strong> <span t-field="doc.send_department_id.name"/></p>
                                    <p><strong>Departamentos Destinatarios:</strong> <span t-out="', '.join(doc.recipient_department_ids.mapped('name'))"/></p>
                                </div>
                                <div t-if="doc.correspondence_flow == 'incoming'">
                                    <p><strong>Remitente Externo:</strong> <span t-field="doc.external_partner_id.name"/></p>
                                    <p><strong>Departamentos Destinatarios (Internos):</strong> <span t-out="', '.join(doc.recipient_department_ids.mapped('name'))"/></p>
                                </div>
                                <div t-if="doc.correspondence_flow == 'outgoing'">
                                    <p><strong>Departamento Remitente (Interno):</strong> <span t-field="doc.send_department_id.name"/></p>
                                    <p><strong>Destinatario Externo:</strong> <span t-field="doc.external_partner_id.name"/></p>
                                </div>
                            </div>
                            <div class="col-md-4 text-center">
                                <div t-if="doc.state in ['signed', 'sent', 'dispatched', 'replied', 'assigned']" class="alert alert-success" role="alert">
                                    <i class="fa fa-check-circle"/> <strong>Documento Válido</strong>
                                    <p>Este documento fue generado y firmado en nuestro sistema.</p>
                                </div>
                                <div t-if="doc.state in ['draft', 'received']" class="alert alert-warning" role="alert">
                                    <i class="fa fa-exclamation-triangle"/> <strong>Documento en Borrador</strong>
                                    <p>Este documento está siendo procesado y aún no es definitivo.</p>
                                </div>
                                <div t-if="not doc.state" class="alert alert-danger" role="alert">
                                    <i class="fa fa-times-circle"/> <strong>Estado Desconocido</strong>
                                    <p>No se pudo determinar la validez de este documento.</p>
                                </div>
                            </div>
                        </div>
                        <hr/>
                        <h3>Contenido del Documento</h3>
                        <div id="description_content" class="mt-3 p-3 border rounded bg-light">
                            <p t-field="doc.descripcion"/>
                        </div>

                        <!-- Sección de Adjuntos Adicionales -->
                        <div t-if="doc.extra_attachment_ids" class="mt-5">
                            <h3>Archivos Adjuntos</h3>
                            <ul class="list-group">
                                <t t-foreach="doc.extra_attachment_ids" t-as="attachment">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span t-out="attachment.name"/>
                                        <a t-att-href="'/correspondence/download/attachment/%s' % attachment.id"
                                            class="btn btn-sm btn-primary"
                                            target="_blank">
                                            <i class="fa fa-download"/> Descargar
                                        </a>
                                    </li>
                                </t>
                            </ul>
                        </div>

                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Nueva plantilla para la página de acceso denegado -->
    <template id="public_access_denied_template" name="Access Denied">
        <t t-call="website.layout">
            <div id="wrap" class="container">
                <div class="oe_structure">
                    <div class="page text-center">
                        <h1 class="mt-5">Acceso Restringido</h1>
                        <div class="alert alert-danger mt-4" role="alert">
                            <i class="fa fa-lock fa-2x" aria-hidden="true"></i>
                            <h4 class="alert-heading mt-2">Usted no tiene acceso a este archivo.</h4>
                            <p>Por motivos de seguridad, la descarga de archivos adjuntos está reservada para usuarios autenticados en el sistema.</p>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>